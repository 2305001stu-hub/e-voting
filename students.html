<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Voting</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('https://images.unsplash.com/photo-1524069290683-0457abfe42c3?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c2Nob29sJTIwc3R1ZGVudHN8ZW58MHx8MHx8fDA%3D') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .navbar {
      background: rgba(0,0,0,0.8);
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .navbar h1 {
      margin: 0;
      font-size: 32px;
      color: #ffcc00;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    }
    
    .container {
      background: rgba(0,0,0,0.7);
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 800px;
      margin: 30px auto;
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
    }
    
    h2 {
      color: #ffcc00;
      margin-bottom: 20px;
      text-align: center;
      font-size: 28px;
      border-bottom: 2px solid #ffcc00;
      padding-bottom: 10px;
    }
    
    .voting-form {
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 10px;
      margin: 20px 0;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #ffcc00;
    }
    
    input[type="text"] {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
    }
    
    .candidate-option {
      display: block;
      margin: 15px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    
    .candidate-option:hover {
      background: rgba(255, 255, 255, 0.2);
      border-left-color: #ffcc00;
      transform: translateX(5px);
    }
    
    .candidate-option input {
      margin-right: 12px;
      transform: scale(1.2);
    }
    
    .candidate-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .candidate-name {
      font-size: 18px;
      font-weight: 500;
    }
    
    .candidate-position {
      font-size: 14px;
      color: #ffcc00;
      font-style: italic;
    }
    
    button[type="submit"] {
      background: #ffcc00;
      color: black;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: block;
      margin: 30px auto 0;
      width: 250px;
    }
    
    button[type="submit"]:hover {
      background: #ffd633;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin: 30px 0 20px;
    }
    
    .btn {
      text-decoration: none;
      background: #ffffff;
      color: #333;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 160px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .btn-primary {
      background: #4CAF50;
      color: white;
    }
    
    .btn-secondary {
      background: #9e9e9e;
      color: white;
    }
    
    .message {
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    
    .success {
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid rgba(76, 175, 80, 0.5);
      color: #4CAF50;
    }
    
    .error {
      background: rgba(244, 67, 54, 0.2);
      border: 1px solid rgba(244, 67, 54, 0.5);
      color: #f44336;
    }
    
    .info {
      background: rgba(33, 150, 243, 0.2);
      border: 1px solid rgba(33, 150, 243, 0.5);
      color: #2196F3;
    }
    
    .warning {
      background: rgba(255, 152, 0, 0.2);
      border: 1px solid rgba(255, 152, 0, 0.5);
      color: #ff9800;
    }
    
    .election-status {
      background: rgba(255, 204, 0, 0.1);
      border: 1px solid #ffcc00;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .status-active {
      color: #4CAF50;
      font-weight: bold;
    }
    
    .status-ended {
      color: #f44336;
      font-weight: bold;
    }
    
    .vote-count {
      text-align: center;
      margin: 15px 0;
      font-size: 16px;
      color: #ffcc00;
    }
    
    @media (max-width: 768px) {
      .container {
        width: 95%;
        padding: 20px;
      }
      
      .buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
      }
      
      .candidate-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
      
      button[type="submit"] {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>Student Voting System</h1>
  </div>
  
  <div class="container">
    <h2>Cast Your Vote</h2>
    
    <!-- Election Status -->
    <div class="election-status">
      <div id="electionStatus">Election Status: <span class="status-active">ACTIVE</span></div>
      <div class="vote-count" id="totalVotesCount">Total Votes Cast: 0</div>
    </div>
    
    <!-- Message display area -->
    <div id="message" class="message" style="display: none;"></div>
    
    <div class="voting-form">
      <form id="votingForm">
        <!-- Student ID Input -->
        <div class="form-group">
          <label for="studentId">Student ID</label>
          <input type="text" id="studentId" name="studentId" placeholder="Enter your student ID (e.g., 20230001)" required>
        </div>
        
        <!-- Student Name Input -->
        <div class="form-group">
          <label for="studentName">Full Name</label>
          <input type="text" id="studentName" name="studentName" placeholder="Enter your full name" required>
        </div>
        
        <!-- Grade/Class Input -->
        <div class="form-group">
          <label for="studentGrade">Grade/Class</label>
          <input type="text" id="studentGrade" name="studentGrade" placeholder="Enter your grade/class (e.g., Grade 10A)" required>
        </div>
        
        <!-- Candidates Section -->
        <div class="form-group">
          <label style="margin-bottom: 15px;">Select Your Candidate:</label>
          <div id="candidatesList">
            <!-- Candidates will be loaded here dynamically -->
          </div>
        </div>
        
        <button type="submit" id="submitVote">Submit Vote</button>
      </form>
    </div>
    
    <div class="buttons">
      <a href="index.html" class="btn btn-secondary">Back to Home</a>
      <a href="results.html" class="btn btn-primary">View Live Results</a>
    </div>
  </div>

  <script>
    // DOM elements
    const messageDiv = document.getElementById('message');
    const candidatesList = document.getElementById('candidatesList');
    const votingForm = document.getElementById('votingForm');
    const studentIdInput = document.getElementById('studentId');
    const studentNameInput = document.getElementById('studentName');
    const studentGradeInput = document.getElementById('studentGrade');
    const submitVoteBtn = document.getElementById('submitVote');
    const electionStatusElement = document.getElementById('electionStatus');
    const totalVotesCountElement = document.getElementById('totalVotesCount');

    // Election settings (could be managed by teachers)
    let electionActive = true;
    let electionEndTime = new Date();
    electionEndTime.setDate(electionEndTime.getDate() + 7); // Election ends in 7 days

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      checkElectionStatus();
      displayCandidates();
      updateVoteCount();
      
      // Check for URL parameters (for messages)
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get('message');
      const success = urlParams.get('success');
      
      if (message) {
        showMessage(message, success === 'true' ? 'success' : 'error');
      }
      
      // Update vote count every 10 seconds
      setInterval(updateVoteCount, 10000);
    });

    // Check election status
    function checkElectionStatus() {
      const now = new Date();
      
      if (now > electionEndTime) {
        electionActive = false;
        electionStatusElement.innerHTML = 'Election Status: <span class="status-ended">ENDED</span>';
        submitVoteBtn.disabled = true;
        submitVoteBtn.textContent = 'Voting Has Ended';
        showMessage('The election has ended. Thank you for participating!', 'info');
      } else {
        // Calculate time remaining
        const timeRemaining = electionEndTime - now;
        const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
        electionStatusElement.innerHTML = `Election Status: <span class="status-active">ACTIVE</span> (${days}d ${hours}h remaining)`;
      }
    }

    // Display candidates from shared data (teachers.html)
    function displayCandidates() {
      candidatesList.innerHTML = '';
      
      // Get candidates from localStorage (shared with teachers.html)
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      
      if (candidates.length === 0) {
        candidatesList.innerHTML = `
          <div class="message info">
            No candidates available for voting at this time. 
            Please check back later or contact your teacher.
          </div>
        `;
        submitVoteBtn.disabled = true;
        return;
      }
      
      if (!electionActive) {
        submitVoteBtn.disabled = true;
        submitVoteBtn.textContent = 'Voting Has Ended';
      }
      
      candidates.forEach(candidate => {
        const candidateOption = document.createElement('label');
        candidateOption.className = 'candidate-option';
        candidateOption.innerHTML = `
          <input type="radio" name="vote" value="${candidate.id}" required>
          <div class="candidate-info">
            <div class="candidate-name">${candidate.name}</div>
            <div class="candidate-position">${candidate.position}</div>
          </div>
        `;
        candidatesList.appendChild(candidateOption);
      });
    }

    // Update the total vote count display
    function updateVoteCount() {
      const votes = JSON.parse(localStorage.getItem('votes') || '[]');
      totalVotesCountElement.textContent = `Total Votes Cast: ${votes.length}`;
    }

    // Handle form submission
    votingForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!electionActive) {
        showMessage('Voting has ended. You can no longer submit votes.', 'error');
        return;
      }
      
      const studentId = studentIdInput.value.trim();
      const studentName = studentNameInput.value.trim();
      const studentGrade = studentGradeInput.value.trim();
      const selectedCandidate = document.querySelector('input[name="vote"]:checked');
      
      // Validation
      if (!studentId) {
        showMessage('Please enter your student ID.', 'error');
        return;
      }
      
      if (!studentName) {
        showMessage('Please enter your full name.', 'error');
        return;
      }
      
      if (!studentGrade) {
        showMessage('Please enter your grade/class.', 'error');
        return;
      }
      
      if (!selectedCandidate) {
        showMessage('Please select a candidate to vote for.', 'error');
        return;
      }
      
      // Validate student ID format (example: at least 8 digits)
      if (!/^\d{8,}$/.test(studentId)) {
        showMessage('Please enter a valid student ID (8 or more digits).', 'error');
        return;
      }
      
      // Get existing data from localStorage (shared with teachers.html)
      const votedStudents = JSON.parse(localStorage.getItem('votedStudents') || '[]');
      const votes = JSON.parse(localStorage.getItem('votes') || '[]');
      const voteCounts = JSON.parse(localStorage.getItem('voteCounts') || '{}');
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      
      // Check if student has already voted
      if (votedStudents.includes(studentId)) {
        showMessage('You have already voted. Each student can only vote once.', 'error');
        return;
      }
      
      // Process the vote
      const candidateId = parseInt(selectedCandidate.value);
      const candidate = candidates.find(c => c.id === candidateId);
      
      if (candidate) {
        // Create vote record
        const vote = {
          id: Date.now(),
          studentId: studentId,
          studentName: studentName,
          studentGrade: studentGrade,
          candidateId: candidateId,
          candidateName: candidate.name,
          timestamp: new Date().toISOString()
        };
        
        // Update all data stores
        votedStudents.push(studentId);
        votes.push(vote);
        
        if (!voteCounts[candidateId]) {
          voteCounts[candidateId] = 0;
        }
        voteCounts[candidateId]++;
        
        // Save to localStorage (shared with teachers.html)
        localStorage.setItem('votedStudents', JSON.stringify(votedStudents));
        localStorage.setItem('votes', JSON.stringify(votes));
        localStorage.setItem('voteCounts', JSON.stringify(voteCounts));
        
        // Show success message
        showMessage(`Thank you for voting, ${studentName}! Your vote for ${candidate.name} has been recorded.`, 'success');
        
        // Update UI
        updateVoteCount();
        
        // Reset form
        votingForm.reset();
        
        // Disable voting for this student
        submitVoteBtn.disabled = true;
        submitVoteBtn.textContent = 'Vote Submitted';
        
        // Redirect to results after 3 seconds
        setTimeout(() => {
          window.location.href = 'results.html';
        }, 3000);
      } else {
        showMessage('Error processing your vote. Please try again.', 'error');
      }
    });

    // Function to show messages
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';
      
      // Scroll to message
      messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      // Hide message after 5 seconds (except for success messages with redirect)
      if (type !== 'success') {
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 5000);
      }
    }

    // Check if student has already voted when they enter their ID
    studentIdInput.addEventListener('blur', function() {
      const studentId = this.value.trim();
      if (studentId) {
        const votedStudents = JSON.parse(localStorage.getItem('votedStudents') || '[]');
        if (votedStudents.includes(studentId)) {
          showMessage('This student ID has already voted. Each student can only vote once.', 'warning');
          submitVoteBtn.disabled = true;
          submitVoteBtn.textContent = 'Already Voted';
        } else {
          submitVoteBtn.disabled = !electionActive;
          submitVoteBtn.textContent = electionActive ? 'Submit Vote' : 'Voting Has Ended';
        }
      }
    });
  </script>
</body>
</html>
