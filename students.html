<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Voting - Student Voting System</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('https://images.unsplash.com/photo-1524069290683-0457abfe42c3?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c2Nob29sJTIwc3R1ZGVudHN8ZW58MHx8MHx8fDA%3D') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      line-height: 1.6;
      min-height: 100vh;
      padding-bottom: 20px;
    }
    
    .navbar {
      background: rgba(0,0,0,0.8);
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .navbar h1 {
      margin: 0;
      font-size: 32px;
      color: #ffcc00;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    }
    
    .container {
      background: rgba(0,0,0,0.7);
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 800px;
      margin: 30px auto;
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
    }
    
    h2 {
      color: #ffcc00;
      margin-bottom: 20px;
      text-align: center;
      font-size: 28px;
      border-bottom: 2px solid #ffcc00;
      padding-bottom: 10px;
    }
    
    h3 {
      color: #ffcc00;
      margin-bottom: 15px;
      font-size: 22px;
    }
    
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #ffcc00;
    }
    
    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
    }
    
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
    }
    
    .btn {
      text-decoration: none;
      background: #ffffff;
      color: #333;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 160px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .btn-primary {
      background: #4CAF50;
      color: white;
    }
    
    .btn-secondary {
      background: #9e9e9e;
      color: white;
    }
    
    .candidate-list {
      margin-top: 20px;
    }
    
    .candidate-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      border-left: 4px solid #ffcc00;
    }
    
    .candidate-name {
      font-size: 18px;
      font-weight: 500;
    }
    
    .vote-btn {
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .vote-btn:hover {
      background: #388E3C;
    }
    
    .vote-btn:disabled {
      background: #9e9e9e;
      cursor: not-allowed;
    }
    
    .message {
      padding: 12px 15px;
      margin: 15px 0;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }
    
    .success {
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid rgba(76, 175, 80, 0.5);
      color: #4CAF50;
    }
    
    .error {
      background: rgba(244, 67, 54, 0.2);
      border: 1px solid rgba(244, 67, 54, 0.5);
      color: #f44336;
    }
    
    .info {
      background: rgba(33, 150, 243, 0.2);
      border: 1px solid rgba(33, 150, 243, 0.5);
      color: #2196F3;
    }
    
    .voting-complete {
      text-align: center;
      padding: 30px;
    }
    
    .voting-complete h2 {
      color: #4CAF50;
      border-bottom: none;
    }
    
    .voting-complete p {
      font-size: 18px;
      margin-bottom: 20px;
    }
    
    .results-preview {
      margin-top: 30px;
    }
    
    .candidate-result {
      margin-bottom: 15px;
    }
    
    .vote-bar-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      height: 30px;
      position: relative;
      overflow: hidden;
    }
    
    .vote-bar {
      background: #4CAF50;
      height: 100%;
      transition: width 0.5s ease;
    }
    
    .vote-count {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    }
    
    .hidden {
      display: none;
    }
    
    @media (max-width: 768px) {
      .container {
        width: 95%;
        padding: 20px;
      }
      
      .buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
      }
      
      .candidate-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>Student Voting System</h1>
  </div>
  
  <div class="container">
    <!-- Student Login Section -->
    <div id="loginSection">
      <h2>Student Login</h2>
      <div class="section">
        <form id="loginForm">
          <div class="form-group">
            <label for="studentId">Student ID</label>
            <input type="text" id="studentId" name="studentId" placeholder="Enter your student ID" required>
          </div>
          <div class="buttons">
            <button type="submit" class="btn btn-primary">Login to Vote</button>
            <a href="index.html" class="btn btn-secondary">Back to Home</a>
          </div>
        </form>
      </div>
      <div id="loginMessage" class="message" style="display: none;"></div>
    </div>
    
    <!-- Voting Section -->
    <div id="votingSection" class="hidden">
      <h2>Cast Your Vote</h2>
      
      <div class="section">
        <div class="student-info">
          <p>Welcome, Student ID: <strong id="displayStudentId"></strong></p>
        </div>
        
        <div id="message" class="message" style="display: none;"></div>
        
        <div id="positionsContainer">
          <!-- Positions and candidates will be dynamically added here -->
        </div>
        
        <div class="buttons">
          <button type="button" id="submitVoteBtn" class="btn btn-primary">Submit Vote</button>
          <button type="button" id="logoutBtn" class="btn btn-secondary">Logout</button>
        </div>
      </div>
    </div>
    
    <!-- Voting Complete Section -->
    <div id="votingCompleteSection" class="hidden">
      <div class="voting-complete">
        <h2>Thank You for Voting!</h2>
        <p>Your vote has been successfully recorded.</p>
        <div class="buttons">
          <button type="button" id="viewResultsBtn" class="btn btn-primary">View Results</button>
          <a href="index.html" class="btn btn-secondary">Back to Home</a>
        </div>
        
        <div class="results-preview">
          <h3>Current Results</h3>
          <div id="resultsPreview">
            <!-- Results will be displayed here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM elements
    const loginSection = document.getElementById('loginSection');
    const votingSection = document.getElementById('votingSection');
    const votingCompleteSection = document.getElementById('votingCompleteSection');
    const loginForm = document.getElementById('loginForm');
    const loginMessage = document.getElementById('loginMessage');
    const displayStudentId = document.getElementById('displayStudentId');
    const positionsContainer = document.getElementById('positionsContainer');
    const submitVoteBtn = document.getElementById('submitVoteBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const viewResultsBtn = document.getElementById('viewResultsBtn');
    const resultsPreview = document.getElementById('resultsPreview');
    const messageDiv = document.getElementById('message');
    
    // Voting data
    let selectedCandidates = {};
    let currentStudentId = '';
    
    // Check if student has already voted
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const studentId = document.getElementById('studentId').value.trim().toUpperCase();
      
      if (!studentId) {
        showLoginMessage('Please enter your student ID.', 'error');
        return;
      }
      
      // Check if student has already voted
      const votedStudents = JSON.parse(localStorage.getItem('votedStudents') || '[]');
      
      if (votedStudents.includes(studentId)) {
        // Student has already voted
        showLoginMessage('You have already voted. Each student can only vote once.', 'error');
        return;
      }
      
      // Check if voting is available (candidates exist)
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      
      if (candidates.length === 0) {
        showLoginMessage('No voting positions available at this time. Please check back later.', 'info');
        return;
      }
      
      // Successful login
      currentStudentId = studentId;
      displayStudentId.textContent = studentId;
      showVotingSection();
      displayCandidates();
    });
    
    // Logout button
    logoutBtn.addEventListener('click', function() {
      currentStudentId = '';
      selectedCandidates = {};
      showLoginSection();
      loginForm.reset();
    });
    
    // Submit vote button
    submitVoteBtn.addEventListener('click', function() {
      // Check if all positions have a selection
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      const positions = [...new Set(candidates.map(c => c.position))];
      
      if (Object.keys(selectedCandidates).length !== positions.length) {
        showMessage('Please vote for all positions before submitting.', 'error');
        return;
      }
      
      // Record the vote
      recordVote();
    });
    
    // View results button
    viewResultsBtn.addEventListener('click', function() {
      window.location.href = 'results.html';
    });
    
    // Function to display candidates by position
    function displayCandidates() {
      positionsContainer.innerHTML = '';
      
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      
      if (candidates.length === 0) {
        positionsContainer.innerHTML = '<div class="message info">No candidates available for voting at this time.</div>';
        submitVoteBtn.disabled = true;
        return;
      }
      
      // Group candidates by position
      const positions = [...new Set(candidates.map(c => c.position))];
      
      positions.forEach(position => {
        const positionSection = document.createElement('div');
        positionSection.className = 'position-section';
        positionSection.innerHTML = `<h3>${position}</h3>`;
        
        const positionCandidates = candidates.filter(c => c.position === position);
        
        positionCandidates.forEach(candidate => {
          const candidateItem = document.createElement('div');
          candidateItem.className = 'candidate-item';
          candidateItem.innerHTML = `
            <div class="candidate-name">${candidate.name}</div>
            <button class="vote-btn" data-position="${position}" data-candidate-id="${candidate.id}">Vote</button>
          `;
          positionSection.appendChild(candidateItem);
        });
        
        positionsContainer.appendChild(positionSection);
      });
      
      // Add event listeners to vote buttons
      document.querySelectorAll('.vote-btn').forEach(button => {
        button.addEventListener('click', function() {
          const position = this.getAttribute('data-position');
          const candidateId = this.getAttribute('data-candidate-id');
          
          // Update selection for this position
          selectedCandidates[position] = candidateId;
          
          // Update button states
          updateButtonStates(position, candidateId);
          
          showMessage(`You selected a candidate for ${position}.`, 'info');
        });
      });
    }
    
    // Function to update button states when a candidate is selected
    function updateButtonStates(selectedPosition, selectedCandidateId) {
      // Reset all buttons for this position to default state
      document.querySelectorAll(`.vote-btn[data-position="${selectedPosition}"]`).forEach(button => {
        button.textContent = 'Vote';
        button.disabled = false;
      });
      
      // Mark the selected candidate
      const selectedButton = document.querySelector(`.vote-btn[data-candidate-id="${selectedCandidateId}"]`);
      selectedButton.textContent = 'Selected âœ“';
      selectedButton.disabled = true;
    }
    
    // Function to record the vote
    function recordVote() {
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      const votedStudents = JSON.parse(localStorage.getItem('votedStudents') || '[]');
      let voteCounts = JSON.parse(localStorage.getItem('voteCounts') || '{}');
      let votes = JSON.parse(localStorage.getItem('votes') || '[]');
      
      // Record votes for each position
      Object.keys(selectedCandidates).forEach(position => {
        const candidateId = selectedCandidates[position];
        
        // Add to vote counts
        if (!voteCounts[candidateId]) {
          voteCounts[candidateId] = 0;
        }
        voteCounts[candidateId]++;
        
        // Add to votes list
        votes.push({
          id: Date.now() + Math.random(), // Simple unique ID
          studentId: currentStudentId,
          candidateId: parseInt(candidateId),
          position: position,
          timestamp: new Date().toISOString()
        });
      });
      
      // Add student to voted students list
      votedStudents.push(currentStudentId);
      
      // Save to localStorage
      localStorage.setItem('votedStudents', JSON.stringify(votedStudents));
      localStorage.setItem('voteCounts', JSON.stringify(voteCounts));
      localStorage.setItem('votes', JSON.stringify(votes));
      
      // Show completion screen
      showVotingCompleteSection();
      displayResultsPreview();
    }
    
    // Function to display results preview
    function displayResultsPreview() {
      resultsPreview.innerHTML = '';
      
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      const voteCounts = JSON.parse(localStorage.getItem('voteCounts') || '{}');
      
      if (candidates.length === 0) {
        resultsPreview.innerHTML = '<div class="message info">No results available.</div>';
        return;
      }
      
      // Group candidates by position
      const positions = [...new Set(candidates.map(c => c.position))];
      
      positions.forEach(position => {
        const positionResults = document.createElement('div');
        positionResults.innerHTML = `<h4>${position}</h4>`;
        
        const positionCandidates = candidates.filter(c => c.position === position);
        
        positionCandidates.forEach(candidate => {
          const voteCount = voteCounts[candidate.id] || 0;
          
          const candidateResult = document.createElement('div');
          candidateResult.className = 'candidate-result';
          candidateResult.innerHTML = `
            <div class="candidate-name">${candidate.name}</div>
            <div class="vote-bar-container">
              <div class="vote-bar" style="width: ${voteCount * 10}%"></div>
              <div class="vote-count">${voteCount} votes</div>
            </div>
          `;
          positionResults.appendChild(candidateResult);
        });
        
        resultsPreview.appendChild(positionResults);
      });
    }
    
    // Function to show login section
    function showLoginSection() {
      loginSection.classList.remove('hidden');
      votingSection.classList.add('hidden');
      votingCompleteSection.classList.add('hidden');
    }
    
    // Function to show voting section
    function showVotingSection() {
      loginSection.classList.add('hidden');
      votingSection.classList.remove('hidden');
      votingCompleteSection.classList.add('hidden');
    }
    
    // Function to show voting complete section
    function showVotingCompleteSection() {
      loginSection.classList.add('hidden');
      votingSection.classList.add('hidden');
      votingCompleteSection.classList.remove('hidden');
    }
    
    // Function to show messages in login section
    function showLoginMessage(text, type) {
      loginMessage.textContent = text;
      loginMessage.className = `message ${type}`;
      loginMessage.style.display = 'block';
      
      // Hide message after 5 seconds
      setTimeout(() => {
        loginMessage.style.display = 'none';
      }, 5000);
    }
    
    // Function to show messages in voting section
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';
      
      // Hide message after 3 seconds
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 3000);
    }
  </script>
</body>
</html>
